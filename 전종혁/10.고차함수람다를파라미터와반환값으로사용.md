# PART_10 고차 함수: 람다를 파라미터와 반환값으로 사용
<br><br>
<hr>

## 다루는 내용

>- 함수 타입
>- 고차 함수와 코드를 구조화 할 때 고차 함수를 사용하는 방법
>- 인라인 함수
>- 비로컬 return 과 레이블
>- 익명 함수

<hr>
<br><br>

### 10.1 다른 함수를 인자로 받거나 반환하는 함수 정의: 고차 함수
- 고차 함수: 다르 ㄴ함수를 인자로 받거나 함수를 반환하는 함수.
- filter 는 술어 함수를 인자로 받으므로 고차 함수다.

### 10.1.1 함수 타입은 람다의 파라미터 타입과 반환 타입을 지정한다
- 함수 타입을 선언할 때는 반환 타입을 반드시 명시해야 한다.

### 10.1.2 인자로 전달 받은 함수 호출
```kotlin
fun twoAndThree(operation: (Int, Int) -> Int) {
    val result = operation(2, 3)
    println("The result is $result")
}

fun main() {
    twoAndThree { a, b -> a + b }
    // The result is 5
    twoAndThree { a, b -> a * b }
    // The result is 6
}
```
- 인자로 받은 함수를 호출하는 구문은 일반 함수를 호출하는 구문과 같다.

### 10.1.3 자바에서 코틀린 함수 타입 사용
```kotlin
fun processTheAnswer(f: (Int) -> Int) {
    println(f(42))
}
```
```java
processTheAnswer(number -> number + 1);
```
- 자바는 첫번째 인자로 수신객체를 전달해야 한다.

### 10.1.4 함수 타입의 파라미터에 대해 기본값을 지정할 수 있고, 널이 될 수도 있다.
- 호출할 때마다 매번 람다를 넘기게 만들면 기본동작으로도 충분한 대부분의 경우 함수 호출을 오히려 더 불편하게 만든다는 문제가 있다.
- 기본값으로 람다식을 넣어 이 문제를 해결할 수 있다.

### 10.1.5 함수를 함수에서 반환
- 프로그램의 상태나 조건에 따라 달라질 수 있는 로직인 경우 함수를 반환하는 함수는 유용하게 사용된다.
- 함수를 반환하려면 return 식에 람다, 멤버 참조, 함수 타입의 값을 계산하는 식 등을 넣으면 된다.

### 10.1.6 람다를 활용해 중복을 줄여 코드 재사용성 높이기
- 중복을 피하기 위해 OS 를 파라미터로 뽑을 수 있다.
- /signup 페이지 평균 방문시간 같이 복잡한 질의를 사용하는 경우 함수 타입을 사용하면 필요한 조건을 파라미터로 뽑아낼 수 있다.

### 10.2 인라인 함수를 사용해 람다의 부가 비용 없애기
### 10.2.1 인라이닝이 작동하는 방식
- 함수를 호출하는 코드를 함수를 호출하는 바이트코드 대신에 함수 본문을 번역한 바이트코드로 컴파일한다.
- synchronized 함수의 본문뿐 아니라 synchronized 에 전달된 람다의 본문도 함께 인라인된다.
- synchronized 를 호출하는 부분에서 람다를 알 수 없는 경우 본문은 인라이닝되지 않는다.

### 10.2.2 인라인 함수의 제약
- 람다가 본문에 직접 펼쳐지기 때문에 함수가 파라미터로 전달받은 람다를 본문에 사용하는 방식이 한정될 수 밖에 없다.
- noinline 변경자를 파라미터 이름 앞에 붙여 인라이닝을 금지할 수 있다.

### 10.2.3 컬렉션 연산 인라이닝
- filter 함수는 인라인 함수이다. 성능에 신경쓰지 않아도 된다.
- 시퀀스에 사용된 람다는 인라이닝되지 않는다.

### 10.2.4 언제 함수를 인라인으로 선언할지 결정
- inline 키워드를 사용해도 람다를 인자로 받는 함수만 성능이 좋아질 가능성이 높다.
- 람다를 인자로 받는 함수를 인라이닝하면 이익이 더 많다.
  - 함수 호출 비용을 줄일 수 있을 뿐 아니라 람다를 표현하는 클래스와 람다 인스턴스에 해당하는 객체를 만들 필요도 없어진다.
  - JVM 은 함수 호출과 람다를 인라이닝해줄 정도로 똑똑하지는 못하다.
  - 비로컬 return 과 같은 기능을 사용할 수 있다.

### 10.2.5 withLock, use, useLines 로 자원 관리를 위해 인라인된 람다 사용
- withLock 은 Lock 인터페이스의 확장 함수다.
- use 함수는 닫을 수 있는 자원에 대해 호출하는 확장 함수다. 인라인 함수이며 그렇기 때문에 성능에는 영향이 없다.
- useLines 는 File 과 Path 객체에 대해 정의돼 있고, 람다가 문자열 시퀀스에 접근하게 해준다.

### 10.3 람다에서 반환: 고차 함수에서 흐름 제어
### 10.3.1 람다 안의 return 문: 람다를 둘러싼 함수에서 반환
- 람다 안에서 return 을 사용하면 람다에서만 반환되는 것이 아니라 그 람다를 호출하는 함수가 실행을 끝내고 반환된다.
- 비로컬 return 자신을 둘러싸고 있는 블록보다 더 바깥에 있는 다른 블록을 반환하게 만드는 return 문

### 10.3.2 람다로부터 반환: 레이블을 이용한 return
- 로컬 return 과 비로컬 return 을 구분하기 위해 레이블을 사용해야 한다.
- 람다식의 레이블을 명시하면 함수 이름을 레이블로 사용할 수 없다.
- 람다식에는 레이블이 2개 이상 붙을 수 없다.

### 10.3.3 익명 함수: 기본적으로 로컬 return
```kotlin
fun lookForAlice(people: List<Person>) {
    people.forEach(fun (person) {
        if (person.name == "Alice") return
        println("${person.name} is not Alice")
    })
}
```
- return 은 가장 가까운 함수를 가리키는데 위 예제에서 가장 가까운 함수는 익명 함수다.
- 익명 함수도 일반 함수와 같은 반환 타입 지정 규칙을 따른다.